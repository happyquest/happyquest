## 概要

CursorのAgentモード（Claude Sonnet）を使用した自動開発における統一ルールを定義します。 このルールに従って開発を行うことで、一貫性のある高品質なコードとドキュメントを生成します。

## 対象読者

- Cursor AgentモードのAI（Claude Sonnet）
- 開発チームメンバー
- プロジェクト関係者

---

## 1. 必須ドキュメント生成ルール

### 1.1 プロジェクト開始時に必須作成

```
1. README.md - プロジェクト概要
2. SRS.md - システム要件仕様書（簡易版）
3. ARCHITECTURE.md - システムアーキテクチャ
4. TEST_POLICY.md - テスト方針書
5. API_SPEC.md - API仕様書
```

### 1.2 文書テンプレート構造

各文書は以下の構造を必須とする：

markdown

```markdown
# [文書タイトル]

## 概要
## 目的と対象読者
## 最終更新日
## 更新者
## 関連文書

[本文]
```

---

## 2. 図表作成ルール

### 2.1 PlantUML必須使用

**すべての図表作成にはPlantUMLを使用すること**

**対象図表：**

- システム構成図
- シーケンス図
- クラス図
- ER図
- ユースケース図
- ネットワーク図

**ファイル命名規則：**

```
docs/plantuml/[図の種類]_[システム名]_[詳細].puml
例：docs/plantuml/sequence_user_login.puml
```

**PlantUML出力形式：**

- 文書内埋め込み：SVG形式
- 個別ファイル：PNG形式（高解像度）

### 2.2 PlantUML記述標準

plantuml

```plantuml
' 必須ヘッダー
@startuml [図名]
!theme plain
skinparam backgroundColor #FEFEFE
skinparam defaultFontName "Noto Sans CJK JP"

' 図の内容

@enduml
```

---

## 3. MCP サーバー使用ルール

### 3.1 必須使用MCPサーバー

**HashiCorp Terraform MCP**

- Google Cloud リソース管理
- インフラストラクチャのコード化
- 使用場面：インフラ構築、環境構築自動化

**Database MCP**

- データベース操作とスキーマ管理
- 使用場面：DB設計、マイグレーション、データ操作

**その他推奨MCPサーバー**

- GitHub MCP：リポジトリ操作、Issue管理
- AWS MCP：AWS リソース管理（必要時）

### 3.2 MCP使用時の必須確認事項

開発開始時に以下を確認・実行：

1. 利用可能なMCPサーバーの一覧表示
2. 各MCPサーバーの機能確認
3. 認証情報の設定状況確認

---

## 4. テスト駆動開発（TDD）ルール

### 4.1 テスト方針の必須明記

プロジェクト開始時に`TEST_POLICY.md`で以下を定義：

markdown

```markdown
## テストレベル定義
- 単体テスト：関数・メソッドレベル
- 結合テスト：モジュール間連携
- システムテスト：E2Eシナリオ
- 受入テスト：ユーザー要件検証

## テスト対象境界
- テスト対象：ビジネスロジック、API、データアクセス層
- テスト対象外：外部API、サードパーティライブラリ

## テストツール・フレームワーク
[プロジェクト固有の選定ツールを記載]

## モック/スタブ使用方針
[具体的な使用基準を記載]
```

### 4.2 TDD開発フロー

1. テストコード作成
2. 実装コード作成
3. リファクタリング
4. 文書更新

---

## 5. API仕様管理ルール

### 5.1 APIDOG使用推奨

**理由：**

- 直感的なUI
- モックサーバー機能充実
- テスト機能統合
- 日本語対応

### 5.2 API仕様管理フロー

1. APIDOG でAPI設計・仕様作成
2. OpenAPI形式でエクスポート
3. CI/CDパイプラインで活用
4. `API_SPEC.md`に概要とリンクを記載

---

## 6. データベース仕様ルール

### 6.1 DB仕様の配置

**小〜中規模プロジェクト：**

- `SRS.md`内にデータ要件を記載
- 別紙として`docs/database/ER_DIAGRAM.puml`を作成

**大規模プロジェクト：**

- `DATABASE_SPEC.md`を独立作成
- 詳細ER図をPlantUMLで作成

### 6.2 DB仕様必須項目

markdown

```markdown
## データ要件
## パフォーマンス要件
## データ整合性要件
## バックアップ・復旧要件
## セキュリティ要件
```

---

## 7. コーディング規約

### 7.1 ファイル構成

```
project/
├── README.md
├── SRS.md
├── ARCHITECTURE.md
├── TEST_POLICY.md
├── API_SPEC.md
├── docs/
│   ├── plantuml/
│   ├── database/
│   └── images/
├── src/
├── tests/
└── infrastructure/
```

### 7.2 コメント・ドキュメント

- 関数・クラスには必ずドキュメント文字列
- 複雑なロジックには日本語コメント
- TODOコメントにはIssue番号を併記

---

## 8. バージョン管理ルール

### 8.1 コミットメッセージ

```
[type]: [subject]

type:
- feat: 新機能
- fix: バグ修正
- docs: ドキュメント更新
- test: テスト追加・修正
- refactor: リファクタリング
```

### 8.2 ブランチ戦略

- main: 本番環境
- develop: 開発環境
- feature/[機能名]: 機能開発
- hotfix/[修正内容]: 緊急修正

---

## 9. 品質保証ルール

### 9.1 コードレビュー必須項目

- [ ]  テストコードの存在確認
- [ ]  PlantUML図の更新確認
- [ ]  API仕様書の更新確認
- [ ]  ドキュメントの一貫性確認

### 9.2 自動チェック項目

- 静的解析パス
- テストカバレッジ80%以上
- セキュリティスキャンパス

---

## 10. 継続的改善

### 10.1 定期見直し

- 月次：ドキュメントの有効性確認
- 四半期：ルール見直し・改善

### 10.2 フィードバック収集

- 開発効率の測定
- ドキュメント品質の評価
- チーム満足度調査

---

## 付録：チェックリスト

### プロジェクト開始時チェックリスト

- [ ]  README.md作成
- [ ]  SRS.md作成
- [ ]  ARCHITECTURE.md作成
- [ ]  TEST_POLICY.md作成
- [ ]  API_SPEC.md作成
- [ ]  PlantUMLファイル構成作成
- [ ]  必要なMCPサーバー接続確認
- [ ]  APIDOG環境セットアップ

### 開発中チェックリスト

- [ ]  TDDサイクル実施
- [ ]  PlantUML図更新
- [ ]  API仕様更新
- [ ]  テストカバレッジ確認
- [ ]  ドキュメント更新

### リリース前チェックリスト

- [ ]  全ドキュメント最新化
- [ ]  PlantUML図出力確認
- [ ]  API仕様書最終確認
- [ ]  テスト完了確認
- [ ]  セキュリティチェック完了

---

**最終更新日:** 2025-05-25  
**更新者:** 開発チーム  
**バージョン:** 1.0