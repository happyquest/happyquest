# コンテキスト最適化システム設計

## 概要
長い文書の分析や複雑なプロジェクト管理において、重要な情報を整理・記憶し、効率的にアクセスできるシステムの設計。

## 1. メモリ階層システム

### 階層構造
```
レベル1: セッションメモリ (即座にアクセス可能)
├── 現在のタスク
├── 重要な決定事項
└── 次のアクション

レベル2: プロジェクトメモリ (プロジェクト期間中保持)
├── プロジェクト目標
├── 主要なステークホルダー
├── 技術的制約
└── 進捗状況

レベル3: 組織メモリ (長期保存)
├── ベストプラクティス
├── 過去の学習
├── 再利用可能なテンプレート
└── 組織固有のルール
```

### 2. 重要度分類システム

#### 優先度レベル
- **P0 (緊急・重要)**: 即座の対応が必要
- **P1 (重要)**: 24時間以内の対応
- **P2 (通常)**: 1週間以内の対応
- **P3 (低優先度)**: 時間があるときに対応

#### コンテキスト分類
- **指示 (INSTRUCTION)**: ユーザーからの直接的な指示
- **参考文献 (REFERENCE)**: 背景情報や参考資料
- **関連箇所 (RELATED)**: 関連する他のプロジェクトや文書
- **重要度 (IMPORTANCE)**: 戦略的重要性

## 3. コンテキスト最適化ルール

### 読み込み順序
1. **現在のセッションコンテキスト**
2. **P0/P1の未完了タスク**
3. **プロジェクト固有の重要情報**
4. **関連する参考文献**
5. **過去の学習・ベストプラクティス**

### 圧縮・初期化ルール
```python
# コンテキスト容量管理
if context_size > threshold:
    # 1. 完了済みタスクをアーカイブ
    archive_completed_tasks()
    
    # 2. 低優先度項目を圧縮
    compress_low_priority_items()
    
    # 3. 古い参考文献を要約化
    summarize_old_references()
    
    # 4. 必要に応じて初期化
    if context_size > critical_threshold:
        initialize_with_core_context()
```

## 4. 実装提案

### ファイルベースメモリシステム
```
memory/
├── session/
│   ├── current_tasks.json
│   ├── decisions.json
│   └── next_actions.json
├── project/
│   ├── {project_id}/
│   │   ├── goals.md
│   │   ├── stakeholders.json
│   │   ├── constraints.md
│   │   └── progress.json
└── organization/
    ├── best_practices/
    ├── templates/
    └── rules/
```

### JSONスキーマ例
```json
{
  "task": {
    "id": "string",
    "title": "string",
    "description": "string",
    "priority": "P0|P1|P2|P3",
    "type": "INSTRUCTION|REFERENCE|RELATED|IMPORTANCE",
    "created_at": "datetime",
    "due_date": "datetime",
    "status": "pending|in_progress|completed|archived",
    "project_id": "string",
    "references": ["url1", "url2"],
    "tags": ["tag1", "tag2"]
  }
}
```

## 5. 使用フロー

### セッション開始時
1. **コンテキスト確認**: 必要な情報が格納されているかチェック
2. **不足情報の特定**: 欠けている重要情報を特定
3. **ユーザーへの提案**: 不足情報の提供を依頼

### 作業中
1. **重要情報の自動抽出**: 文書から重要箇所を特定
2. **メモリへの格納**: 適切な階層に情報を保存
3. **関連情報の提示**: 関連する過去の情報を提示

### セッション終了時
1. **進捗の記録**: 完了したタスクと残りのタスクを記録
2. **学習の抽出**: 新しく得られた知見を組織メモリに保存
3. **次回への引き継ぎ**: 次のセッションで必要な情報を準備

## 6. メモ領域の可視化

### ダッシュボード形式
```
┌─ セッションメモリ ─────────────────────┐
│ 🔴 P0: Atlassian MCP設定 (緊急)        │
│ 🟡 P1: PRD作成プロンプト最適化         │
│ 🟢 P2: ドキュメント整理                │
└────────────────────────────────────┘

┌─ プロジェクトメモリ ───────────────────┐
│ 📋 プロジェクト: HappyQuest開発        │
│ 🎯 目標: Teamwork Graph統合           │
│ 👥 ステークホルダー: nanashi7777      │
│ 📊 進捗: 30% (分析完了、実装準備中)    │
└────────────────────────────────────┘

┌─ 参考資料 ─────────────────────────┐
│ 📄 docs/04_AIを活用したPRD作成.md     │
│ 🔗 Atlassian API Documentation       │
│ 📋 MCP Server Setup Guide           │
└────────────────────────────────────┘
```

## 7. 実装優先度

### Phase 1 (即座に実装)
- [ ] セッションメモリシステム
- [ ] 基本的なタスク管理
- [ ] 重要度分類

### Phase 2 (1週間以内)
- [ ] プロジェクトメモリシステム
- [ ] 参考文献管理
- [ ] コンテキスト圧縮機能

### Phase 3 (1ヶ月以内)
- [ ] 組織メモリシステム
- [ ] 自動学習機能
- [ ] 高度な最適化ルール