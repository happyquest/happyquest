#!/bin/bash

# ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ä¿å­˜æ”¯æ´ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
# æ‰‹å‹•ã§ã®ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ä¿å­˜ã‚’æ”¯æ´

set -e

CHAT_DIR="chat-logs"
mkdir -p "$CHAT_DIR"

TIMESTAMP=$(date +%Y%m%d-%H%M%S)
CHAT_FILE="$CHAT_DIR/chat-session-$TIMESTAMP.md"

echo "ðŸ’¬ ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ä¿å­˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆ"
echo "=============================="
echo "ðŸ“… å®Ÿè¡Œæ—¥æ™‚: $(date)"
echo "ðŸ“ ä¿å­˜å…ˆ: $CHAT_FILE"
echo

# å¼•æ•°ãƒã‚§ãƒƒã‚¯
if [ $# -eq 0 ]; then
    echo "ä½¿ç”¨æ–¹æ³•: $0 \"ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦\""
    echo "ä¾‹: $0 \"ã‚¨ãƒ©ãƒ¼äºˆé˜²ã‚·ã‚¹ãƒ†ãƒ å®Ÿè£…\""
    exit 1
fi

SESSION_SUMMARY="$1"

# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
cat > "$CHAT_FILE" << EOF
# ãƒãƒ£ãƒƒãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ­ã‚°

**ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹**: $(date)  
**ä½œæ¥­è€…**: $(whoami)  
**ãƒ–ãƒ©ãƒ³ãƒ**: $(git branch --show-current 2>/dev/null || echo "ä¸æ˜Ž")  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: HappyQuest  
**ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦**: $SESSION_SUMMARY

## ðŸ“‹ ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦

### ä¸»ãªä½œæ¥­å†…å®¹
- [ ] [ä½œæ¥­å†…å®¹1]
- [ ] [ä½œæ¥­å†…å®¹2]
- [ ] [ä½œæ¥­å†…å®¹3]

### é‡è¦ãªæ±ºå®šäº‹é …
1. **æŠ€è¡“é¸æŠž**: [æ±ºå®šå†…å®¹]
2. **è¨­è¨ˆæ–¹é‡**: [æ±ºå®šå†…å®¹]
3. **å®Ÿè£…æ–¹é‡**: [æ±ºå®šå†…å®¹]

### ç™ºç”Ÿã—ãŸå•é¡Œã¨è§£æ±ºç­–
1. **å•é¡Œ**: [å•é¡Œå†…å®¹]
   **è§£æ±ºç­–**: [è§£æ±ºæ–¹æ³•]
   
2. **å•é¡Œ**: [å•é¡Œå†…å®¹]
   **è§£æ±ºç­–**: [è§£æ±ºæ–¹æ³•]

## ðŸ’¡ é‡è¦ãªå­¦ç¿’ãƒ»ç™ºè¦‹

### æŠ€è¡“çš„ç™ºè¦‹
- [ç™ºè¦‹å†…å®¹1]
- [ç™ºè¦‹å†…å®¹2]

### ãƒ—ãƒ­ã‚»ã‚¹æ”¹å–„
- [æ”¹å–„ç‚¹1]
- [æ”¹å–„ç‚¹2]

## ðŸ”— é–¢é€£ãƒªã‚½ãƒ¼ã‚¹

### ä½œæˆãƒ»å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«
EOF

# æœ€è¿‘å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å–å¾—
if git rev-parse --git-dir > /dev/null 2>&1; then
    echo "$(git diff --name-only HEAD~3..HEAD 2>/dev/null | head -10)" | while read -r file; do
        if [ -n "$file" ]; then
            echo "- $file: [å¤‰æ›´å†…å®¹ã‚’è¨˜è¼‰]" >> "$CHAT_FILE"
        fi
    done
else
    echo "- [ãƒ•ã‚¡ã‚¤ãƒ«å1]: [å¤‰æ›´å†…å®¹]" >> "$CHAT_FILE"
    echo "- [ãƒ•ã‚¡ã‚¤ãƒ«å2]: [å¤‰æ›´å†…å®¹]" >> "$CHAT_FILE"
fi

cat >> "$CHAT_FILE" << EOF

### å‚è€ƒã«ã—ãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ãƒªãƒ³ã‚¯
- [ãƒªãƒ³ã‚¯1]: [èª¬æ˜Ž]
- [ãƒªãƒ³ã‚¯2]: [èª¬æ˜Ž]

## ðŸ“Š æˆæžœç‰©

### å®Œäº†ã—ãŸä½œæ¥­
- âœ… [å®Œäº†ã—ãŸä½œæ¥­1]
- âœ… [å®Œäº†ã—ãŸä½œæ¥­2]
- â¸ï¸ [éƒ¨åˆ†å®Œäº†ã—ãŸä½œæ¥­3]

### æ¬¡å›žã¸ã®å¼•ãç¶™ãŽäº‹é …
- [ ] [å¼•ãç¶™ãŽäº‹é …1]
- [ ] [å¼•ãç¶™ãŽäº‹é …2]

## ðŸŽ¯ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å³åº§ã«å¿…è¦ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- [ ] [ã‚¢ã‚¯ã‚·ãƒ§ãƒ³1] - æœŸé™: [æ—¥æ™‚]
- [ ] [ã‚¢ã‚¯ã‚·ãƒ§ãƒ³2] - æœŸé™: [æ—¥æ™‚]

### å°†æ¥çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- [ ] [ã‚¢ã‚¯ã‚·ãƒ§ãƒ³1] - æœŸé™: [æ—¥æ™‚]
- [ ] [ã‚¢ã‚¯ã‚·ãƒ§ãƒ³2] - æœŸé™: [æ—¥æ™‚]

---

**ãƒ­ã‚°ä½œæˆæ—¥æ™‚**: $(date)  
**æ¬¡å›žã‚»ãƒƒã‚·ãƒ§ãƒ³äºˆå®š**: [æ—¥æ™‚]

## ðŸ“ å®Ÿéš›ã®ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°

<!-- ã“ã“ã«æ‰‹å‹•ã§ãƒãƒ£ãƒƒãƒˆã®é‡è¦ãªéƒ¨åˆ†ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆã—ã¦ãã ã•ã„ -->

### é‡è¦ãªè³ªå•ã¨å›žç­”

**Q**: [è³ªå•å†…å®¹]
**A**: [å›žç­”å†…å®¹]

**Q**: [è³ªå•å†…å®¹]
**A**: [å›žç­”å†…å®¹]

### å®Ÿè¡Œã—ãŸã‚³ãƒžãƒ³ãƒ‰

\`\`\`bash
# å®Ÿè¡Œã—ãŸã‚³ãƒžãƒ³ãƒ‰ã‚’ã“ã“ã«è¨˜éŒ²
EOF

# æœ€è¿‘å®Ÿè¡Œã•ã‚ŒãŸã‚³ãƒžãƒ³ãƒ‰ã®å±¥æ­´ã‚’å–å¾—ï¼ˆå¯èƒ½ãªå ´åˆï¼‰
if [ -f ~/.bash_history ]; then
    echo "# æœ€è¿‘ã®ã‚³ãƒžãƒ³ãƒ‰å±¥æ­´ï¼ˆå‚è€ƒï¼‰" >> "$CHAT_FILE"
    tail -20 ~/.bash_history | grep -E "(git|npm|node|./scripts)" | tail -10 >> "$CHAT_FILE"
fi

cat >> "$CHAT_FILE" << EOF
\`\`\`

### ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰

\`\`\`javascript
// é‡è¦ãªã‚³ãƒ¼ãƒ‰ç‰‡ã‚’ã“ã“ã«è¨˜éŒ²
\`\`\`

### ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ã®ã‚¨ãƒ©ãƒ¼ã¨è§£æ±º

**ã‚¨ãƒ©ãƒ¼**: [ã‚¨ãƒ©ãƒ¼å†…å®¹]
**è§£æ±ºæ–¹æ³•**: [è§£æ±ºæ‰‹é †]

**ã‚¨ãƒ©ãƒ¼**: [ã‚¨ãƒ©ãƒ¼å†…å®¹]
**è§£æ±ºæ–¹æ³•**: [è§£æ±ºæ‰‹é †]

## ðŸ“ˆ ãƒ¡ãƒˆãƒªã‚¯ã‚¹

### ä½œæ¥­åŠ¹çŽ‡
- **äºˆå®šæ™‚é–“**: [Xæ™‚é–“]
- **å®Ÿéš›æ™‚é–“**: [Xæ™‚é–“]
- **åŠ¹çŽ‡**: [äºˆå®š/å®Ÿéš› * 100]%

### å“è³ª
- **ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ•°**: [Xä»¶]
- **è§£æ±ºæ¸ˆã¿**: [Xä»¶]
- **æœªè§£æ±º**: [Xä»¶]

### å­¦ç¿’
- **æ–°ã—ã„æŠ€è¡“**: [æŠ€è¡“å]
- **æ”¹å–„ã—ãŸãƒ—ãƒ­ã‚»ã‚¹**: [ãƒ—ãƒ­ã‚»ã‚¹å]
- **æ¬¡å›žæ´»ç”¨äºˆå®š**: [å†…å®¹]

EOF

echo "âœ… ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆå®Œäº†"
echo "ðŸ“ æ‰‹å‹•ã§ãƒãƒ£ãƒƒãƒˆå†…å®¹ã‚’è¿½è¨˜ã—ã¦ãã ã•ã„: $CHAT_FILE"
echo
echo "ðŸ’¡ ä½¿ç”¨æ–¹æ³•:"
echo "   1. é‡è¦ãªè³ªå•ãƒ»å›žç­”ã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ"
echo "   2. å®Ÿè¡Œã—ãŸã‚³ãƒžãƒ³ãƒ‰ã‚’è¨˜éŒ²"
echo "   3. ç”Ÿæˆã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ä¿å­˜"
echo "   4. å­¦ç¿’ãƒ»ç™ºè¦‹äº‹é …ã‚’è¨˜éŒ²"
echo "   5. ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•ã‚’è¨˜éŒ²"
echo
echo "ðŸ”§ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:"
echo "   1. ã‚¨ãƒ‡ã‚£ã‚¿ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã: code $CHAT_FILE"
echo "   2. ãƒãƒ£ãƒƒãƒˆå†…å®¹ã‚’æ‰‹å‹•ã§è¿½è¨˜"
echo "   3. Gitã«ã‚³ãƒŸãƒƒãƒˆ: git add $CHAT_FILE && git commit -m \"ãƒãƒ£ãƒƒãƒˆãƒ­ã‚°ä¿å­˜: $SESSION_SUMMARY\""