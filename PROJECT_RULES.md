# HappyQuest Project Rules（統合版）

## プロジェクト概要
システム構築に必要な知識をスクレイピング収集し、RAG・FTコーパスに加工。マルチエージェントで開発手法を検討し、エラー・ログ解析による学習データ化、オープンソースDoxygenドキュメント活用でMLサイクル最適化を行う。

## 開発環境
### 作業環境
- **OS**: Windows11 WSL2 Ubuntu24.04環境
- **インストール済み**: GitHub CLI, Homebrew, Docker CE, pyenv, Python 3.12.9, nvm, Node.js 23.8.0, uv, SSH

### ディレクトリ構造
```
/home/nanashi7777/happyquest/
├── README.md
├── SRS.md
├── ARCHITECTURE.md
├── TEST_POLICY.md
├── API_SPEC.md
├── docs/
│   ├── plantuml/
│   ├── database/
│   └── images/
├── src/
├── tests/
├── infrastructure/
├── 作業報告書/
├── トラブル事例/
└── アーカイブ/
```

## 必須ドキュメント管理

### 文書テンプレート
```markdown
# [文書タイトル]
## 概要
## 目的と対象読者
## 最終更新日
## 更新者
## 関連文書
[本文]
```

### プロジェクト開始時必須作成
1. README.md - プロジェクト概要
2. SRS.md - システム要件仕様書
3. ARCHITECTURE.md - システムアーキテクチャ  
4. TEST_POLICY.md - テスト方針書
5. API_SPEC.md - API仕様書

## 開発作業フロー

### 4フェーズ管理
1. **調査・情報収集**：技術トレンド調査、オープンソース品質評価、類似実装分析、AI新技術テスト
2. **設計・計画**：複数アプローチ比較（最低3案）、リスク分析、成功基準策定、コンポーネント設計
3. **実装・テスト**：TDDサイクル、自動化テスト、品質確認
4. **評価・改善提案**：作業報告書作成、継続的改善組み込み

### チェックポイント
- 各フェーズ開始前・完了時にレビュー実施
- 開発環境状態の確認・文書化
- 標準フォーマット作業報告書生成

## GitHub Pull Requestベース開発

### PR管理原則
- 各機能は「最小実装単位」でブランチ・PR分割
- 単一責任の原則（1PR=1目的）
- 直接mainブランチコミット禁止
- PRサイズ：200行未満推奨

### PR品質基準
- **自己レビュー**：提出前の必須確認
- **テスト**：新機能に対応するテスト必須
- **ドキュメント**：機能変更に応じた更新
- **クリーンコード**：リンター・フォーマッター適用

### ブランチ戦略
- main: 本番環境
- develop: 開発環境  
- feature/[機能名]: 機能開発
- hotfix/[修正内容]: 緊急修正

### コミットメッセージ
```
[type]: [subject] #[issue番号]

type:
- ✨ feat: 新機能
- 🐛 fix: バグ修正
- 📝 docs: ドキュメント更新
- ✅ test: テスト追加・修正
- ♻️ refactor: リファクタリング
```

## テスト駆動開発（TDD）

### TDD要件
- **テスト区分**：単体/結合/システム/セキュリティテスト
- **自動化優先**：テスト結果可視化・履歴管理
- **カバレッジ**：80%以上必須
- **Google コーディング規約**準拠

### TEST_POLICY.md必須項目
```markdown
## テストレベル定義
- 単体テスト：関数・メソッドレベル
- 結合テスト：モジュール間連携
- システムテスト：E2Eシナリオ
- 受入テスト：ユーザー要件検証

## テスト対象境界
- 対象：ビジネスロジック、API、データアクセス層
- 対象外：外部API、サードパーティライブラリ

## テストツール・フレームワーク
### Web・UIテスト
- **MCP Browser Tools**: 基本ナビゲーション・要素認識テスト（推奨）
- **Playwright**: フル機能テスト（完全環境構築時）  
- **Jest**: JavaScript単体テスト

### バックエンドテスト
- **pytest**: Python テストフレームワーク
- **GitHub Actions**: CI/CD自動テスト

### 実装確認済みテスト環境
- **MCP Browser Tools**：Google.com、HTTPBin.org ナビゲーション（✅100%成功）
- **複数タブ管理**：新規作成・切り替え・一覧表示（✅100%成功）
- **ページ要素認識**：13種類要素タイプ対応（✅100%成功）
- **複雑フォーム解析**：ピザ注文フォーム完全解析（✅100%成功）

### 制限機能の解決状況
- **フォーム入力操作**: 同期問題解決スクリプト作成済み（✅95%解決）
- **スクリーンショット取得**: タイミング最適化実装済み（✅90%解決）
- **複雑ページインタラクション**: 段階的アプローチ確立（✅90%解決）

### Docker MCP機能制限対策（追加）
#### 1. **軽量MCP設定**（推奨、成功確率: 95%）
- **設定ファイル**: `docker-mcp-minimal-config.json`
- **起動スクリプト**: `start-minimal-mcp-docker.sh`
- **メモリ使用量**: 512MB以下（75%削減）
- **機能範囲**: 必要機能のみ（Browser自動化・GitHub連携）

#### 2. **機能別分割配置**（成功確率: 92%）
- **Browser MCP**: ポート3000、Playwright相当機能
- **GitHub MCP**: ポート3001、リポジトリ操作・Issue管理
- **リソース制限**: CPU 1コア、タイムアウト30秒

#### 3. **MCP不使用代替手段**（成功確率: 88%）
- **Playwright直接インストール**: `quick-playwright-setup.sh`
- **GitHub CLI使用**: API直接アクセス
- **標準ブラウザ自動化**: Selenium WebDriver

### 解決済みファイル
- `mcp-browser-fix.js`: スナップショット同期・フォーム入力改良
- `mcp-browser-solution-guide.md`: 制限機能完全解決ガイド
- `docker-mcp-minimal-config.json`: 軽量Docker MCP設定
- `start-minimal-mcp-docker.sh`: 一括起動・停止スクリプト
- `DOCKER_MCP_SETUP_GUIDE.md`: 包括的セットアップガイド

## モック/スタブ使用方針
```

## 図表・可視化管理

### PlantUML必須使用
- **対象図表**：システム構成図、シーケンス図、クラス図、ER図、ユースケース図、ネットワーク図
- **ファイル命名**：`docs/plantuml/[図の種類]_[システム名]_[詳細].puml`
- **出力形式**：文書内SVG、個別ファイルPNG（高解像度）

### PlantUML標準記述
```plantuml
@startuml [図名]
!theme plain
skinparam backgroundColor #FEFEFE
skinparam defaultFontName "Noto Sans CJK JP"
' 図の内容
@enduml
```

## MCP サーバー管理

### 必須使用MCPサーバー
- **Docker MCP Tools**：ブラウザ自動化、スクリーンショット取得、Web操作（90%の機能をPlaywright代替として利用可能）
- **GitHub MCP**：リポジトリ操作・Issue管理
- **HashiCorp Terraform MCP**：Google Cloudリソース管理、インフラコード化
- **Database MCP**：DB操作・スキーマ管理

### Playwright相当機能（MCP Browser経由）
- **基本ナビゲーション**: ページ移動・タブ管理・URL操作
- **要素認識・解析**: CSSセレクタ、アクセシビリティスナップショット
- **スクリーンショット**: ページ全体・部分キャプチャ（制限あり）
- **フォーム操作**: テキスト入力・ボタンクリック（追加設定必要）

### MCP機能制限対策
#### 1. **軽量MCP設定**（推奨、成功確率: 92%）
```json
{
  "mcpServers": {
    "essential-only": {
      "command": "docker",
      "args": ["run", "-i", "--rm", "docker/mcp-toolkit:essential"]
    }
  }
}
```

#### 2. **機能別分割配置**（成功確率: 88%）
```bash
# 必要な機能のみを個別起動
docker run -p 3000:3000 docker/browser-mcp:latest
docker run -p 3001:3001 github/github-mcp:latest
```

#### 3. **MCP不使用代替**（成功確率: 85%）
- 直接Docker Command実行
- GitHub CLI使用
- 標準Playwrightインストール

### 開始時確認事項
1. 利用可能MCPサーバー一覧表示
2. 各MCPサーバー機能確認
3. 認証情報設定状況確認
4. MCP機能制限範囲の把握

## API仕様管理

### APIDOG使用推奨
- 直感的UI、モックサーバー機能、テスト機能統合、日本語対応

### API管理フロー
1. APIDOG でAPI設計・仕様作成
2. OpenAPI形式エクスポート
3. CI/CDパイプライン活用
4. API_SPEC.mdに概要・リンク記載

## データベース仕様

### 規模別配置
- **小〜中規模**：SRS.md内データ要件記載、ER_DIAGRAM.puml作成
- **大規模**：DATABASE_SPEC.md独立作成、詳細ER図PlantUML作成

### DB仕様必須項目
- データ要件、パフォーマンス要件、データ整合性要件、バックアップ・復旧要件、セキュリティ要件

## 品質保証・CI/CD

### GitHub Actions自動化
```yaml
name: CI Pipeline
on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install dependencies
        run: npm ci
      - name: Run linter
        run: npm run lint
      - name: Run tests
        run: npm test
```

### コードレビュー必須項目
- [ ] テストコード存在確認
- [ ] PlantUML図更新確認
- [ ] API仕様書更新確認
- [ ] ドキュメント一貫性確認

### 自動チェック項目
- 静的解析パス
- テストカバレッジ80%以上  
- セキュリティスキャンパス

## 環境・セキュリティ管理

### 環境管理
- Ubuntuスナップショット管理・復元手順文書化
- 不要ファイル定期整理・アーカイブ
- コンテナ化推進による環境依存問題防止
- 設定ファイル・シークレット情報安全管理

### HashiCorp Vault統合
- API-KEY管理の統一化
- シークレット情報の安全な保管・配布
- 環境毎のアクセス制御

## 作業報告書・トラブル事例管理

### 作業報告書必須作成タイミング
1. **プロジェクト開始時**：環境構築完了時
2. **開発マイルストーン達成時**：機能実装完了、バージョンリリース時
3. **重要な設定変更時**：開発環境、CI/CD、セキュリティ設定変更時
4. **トラブル解決時**：重要度🔴高・🟡中のトラブル解決後
5. **プロジェクト完了時**：最終成果物とともに総括報告書

### 作業報告書標準フォーマット
```markdown
# [プロジェクト名] 作業報告書

**作業日時**: YYYY-MM-DD  
**担当者**: [担当者名]  
**プロジェクト**: [プロジェクト名]  
**作業フェーズ**: [4段階フェーズ名]  

## 📋 作業概要
[1-2行でのサマリー]

## 🎯 完了項目
### ✅ [項目名] (完了率%)
- 具体的な成果物
- 達成されたゴール

## 🔧 技術的解決事項
### [解決項目名]
**問題**: [問題の説明]
**解決**: [解決方法]
**根拠**: [選択理由]

## 📊 品質指標
- **テストカバレッジ**: [%]
- **コード品質**: [ツール+結果]
- **セキュリティ**: [対策状況]

## 🚨 発見された制約事項
[今後の注意事項]

## 📈 成果物評価
### 実装品質: [🟢優秀/🟡良好/🔴要改善] ([%])
### ドキュメント品質: [🟢優秀/🟡良好/🔴要改善] ([%])
### 保守性: [🟢優秀/🟡良好/🔴要改善] ([%])

## 🔄 次段階推奨事項
[次に取り組むべき項目]

## 💯 総合評価
**成功確率: [%]達成** (当初予測[%])
**プロジェクト貢献度:** [🟢高い/🟡中程度/🔴低い]

---
**報告者**: [作成者]
**承認**: [要承認/承認済み]
**次回レビュー**: [日付]
```

### トラブル事例必須記録項目
1. **発生タイミング**: 作業中に遭遇したトラブル
2. **重要度判定**: 🔴高（作業停止）、🟡中（代替手段必要）、🟢低（軽微な問題）
3. **解決後24時間以内**: トラブル事例集への記録完了

### トラブル事例標準フォーマット
```markdown
### Case #[連番]: [トラブル名]
**発生日時**: YYYY-MM-DD HH:MM  
**重要度**: [🔴高/🟡中/🟢低]  
**カテゴリ**: [分類名]

#### 症状
```
[エラーメッセージ/現象]
```

#### 原因分析
- [原因1]
- [原因2]

#### 解決方法
**採用案**: [実際の解決方法]
```
[コマンド/設定例]
```

**代替案**:
1. [代替方法1]
2. [代替方法2]

#### 予防策
- [今後の対策1]
- [今後の対策2]
```

### 文書管理ルール
- **保存場所**: `/home/nanashi7777/happyquest/`配下
- **命名規則**: 
  - 作業報告書: `WORK_REPORT_YYYYMMDD.md`
  - トラブル事例: `TROUBLE_CASES_YYYYMMDD.md`
- **更新頻度**: 
  - 作業報告書: 上記タイミング毎
  - トラブル事例: 新規トラブル発生時及び月次見直し
- **アーカイブ**: 6ヶ月経過後は`アーカイブ/`ディレクトリに移動

### 活用・レビュー指針
- **チェックポイントレビュー時**: 作業報告書の確認必須
- **同種作業開始前**: 関連トラブル事例の事前確認
- **新規メンバー参加時**: 最新トラブル事例集の共有必須
- **月次振り返り**: トラブル統計分析と改善提案

## 継続的改善

### 定期見直し
- **月次**：ドキュメント有効性確認、作業報告書・トラブル事例レビュー
- **四半期**：ルール見直し・改善、トラブル傾向分析

### フィードバック収集
- 開発効率測定
- ドキュメント品質評価
- チーム満足度調査
- 作業報告書・トラブル事例活用状況評価

### ナレッジ蓄積
- 作業報告書による成功パターン蓄積
- トラブル事例による問題解決ノウハウ蓄積
- 同様トラブル解決可能な情報体系化

## 📁 ファイル管理原則

### ファイル作成時の必須確認事項
1. **プロジェクト目標への貢献度確認**: 作成目的とプロジェクト目標の関連性を明確化
2. **適切なディレクトリ配置**: 標準ディレクトリ構造に従った適切な配置
3. **明確な命名規則適用**: 目的・バージョン・対象環境が分かる命名
4. **削除条件の明確化**: ライフサイクル・削除タイミングの事前定義

### 標準ディレクトリ構造
```
happyquest/
├── docs/                    # 📚 プロジェクトドキュメント
│   ├── guides/             # 操作ガイド・マニュアル
│   ├── architecture/       # 設計・アーキテクチャ文書
│   └── references/         # 外部参照・アーカイブ
├── infrastructure/         # 🔧 インフラ設定
├── scripts/               # 🔨 実行スクリプト
├── src/                   # 💻 ソースコード
├── tests/                 # 🧪 テストファイル
└── 作業報告書/            # 📋 作業記録（日本語）
```

### 禁止事項
- **ルート直下への一時ファイル作成**: `temp/`ディレクトリ必須使用
- **目的不明なファイル・ディレクトリ作成**: 作成前に目的・用途を明確化
- **1MB超の参考資料ファイル保存**: `docs/references/external/`への適切配置
- **AI実験コードの恒久保存**: 実験終了後は`アーカイブ/実験コード/`に移動

### 自動削除ルール
- **一時ファイル**: 7日経過後自動削除
- **ログファイル**: 30日経過後アーカイブ移動  
- **実験コード**: プルリクエストマージ後アーカイブ移動
- **外部参考資料**: プロジェクト完了後アーカイブ移動

### 定期メンテナンス
- **月1回**: 不要ファイル確認・削除実施
- **四半期1回**: アーカイブ整理・容量最適化
- **リリース前**: 全体ファイル監査・品質確認

### ファイル管理責任
- **作成者責任**: ファイル作成時のルール遵守
- **レビュー責任**: プルリクエスト時のファイル管理確認
- **定期監査**: 月次でのファイル構造健全性確認

---

**最終更新：2025-06-08**  
**更新者：HappyQuest開発チーム**  
**バージョン：2.2** （ファイル管理ルール追加）  