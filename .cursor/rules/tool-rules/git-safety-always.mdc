---
description: 
globs: 
alwaysApply: false
---
# Gitå®‰å…¨æ“ä½œãƒ«ãƒ¼ãƒ«

## ğŸš« ä½¿ç”¨ç¦æ­¢ã‚³ãƒãƒ³ãƒ‰

### 1. å±¥æ­´æ”¹å¤‰ç³»ï¼ˆå…±æœ‰ãƒ–ãƒ©ãƒ³ãƒã§çµ¶å¯¾ç¦æ­¢ï¼‰

#### `git push --force` / `git push -f`
```bash
# âŒ çµ¶å¯¾ç¦æ­¢ï¼ˆmainãƒ–ãƒ©ãƒ³ãƒï¼‰
git push --force origin main
git push -f origin develop

# ç†ç”±:
# - ä»–ã®é–‹ç™ºè€…ã®ä½œæ¥­ã‚’ç ´å£Š
# - å±¥æ­´ã®æ•´åˆæ€§ãŒå¤±ã‚ã‚Œã‚‹
# - CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒæ··ä¹±
# - ãƒ¬ãƒ“ãƒ¥ãƒ¼å±¥æ­´ãŒå¤±ã‚ã‚Œã‚‹

# âœ… ä»£æ›¿æ¡ˆ
git push --force-with-lease origin feature-branch  # ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒã®ã¿
```

#### `git rebase` (å…±æœ‰ãƒ–ãƒ©ãƒ³ãƒã§ç¦æ­¢)
```bash
# âŒ å…±æœ‰ãƒ–ãƒ©ãƒ³ãƒã§ç¦æ­¢
git checkout main
git rebase feature-branch

# ç†ç”±:
# - å±¥æ­´ã®ç·šå½¢åŒ–ã«ã‚ˆã‚Šã€ãƒãƒ¼ã‚¸ã®æ–‡è„ˆãŒå¤±ã‚ã‚Œã‚‹
# - ä»–ã®é–‹ç™ºè€…ã®ãƒ­ãƒ¼ã‚«ãƒ«å±¥æ­´ã¨ä¸æ•´åˆ
# - Pull Requestã®å±¥æ­´ãŒè¿½è·¡å›°é›£

# âœ… ä»£æ›¿æ¡ˆ
git merge --no-ff feature-branch  # ãƒãƒ¼ã‚¸ã‚³ãƒŸãƒƒãƒˆã‚’æ˜ç¤ºçš„ã«ä½œæˆ
```

### 2. ç›´æ¥æ“ä½œç³»ï¼ˆä¿è­·ãƒ–ãƒ©ãƒ³ãƒã§ç¦æ­¢ï¼‰

#### `git commit --amend` (ãƒ—ãƒƒã‚·ãƒ¥æ¸ˆã¿)
```bash
# âŒ ãƒ—ãƒƒã‚·ãƒ¥æ¸ˆã¿ã‚³ãƒŸãƒƒãƒˆã§ç¦æ­¢
git commit --amend -m "ä¿®æ­£ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
git push --force

# ç†ç”±:
# - ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ãŒå¤‰æ›´ã•ã‚Œã‚‹
# - ä»–ã®é–‹ç™ºè€…ã®å‚ç…§ãŒç„¡åŠ¹ã«ãªã‚‹
# - CI/CDã®å®Ÿè¡Œå±¥æ­´ã¨ä¸æ•´åˆ

# âœ… ä»£æ›¿æ¡ˆ
git commit -m "fix: å‰å›ã‚³ãƒŸãƒƒãƒˆã®ä¿®æ­£"  # æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆã§ä¿®æ­£
```

#### `git reset --hard` (å…±æœ‰ãƒ–ãƒ©ãƒ³ãƒã§ç¦æ­¢)
```bash
# âŒ å…±æœ‰ãƒ–ãƒ©ãƒ³ãƒã§ç¦æ­¢
git reset --hard HEAD~3
git push --force

# ç†ç”±:
# - ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ãŒå®Œå…¨ã«å¤±ã‚ã‚Œã‚‹
# - ä»–ã®é–‹ç™ºè€…ã®ä½œæ¥­åŸºç›¤ãŒç ´å£Š
# - å¾©æ—§ãŒå›°é›£

# âœ… ä»£æ›¿æ¡ˆ
git revert HEAD~2..HEAD  # ãƒªãƒãƒ¼ãƒˆã‚³ãƒŸãƒƒãƒˆã§å®‰å…¨ã«å–ã‚Šæ¶ˆã—
```

### 3. å±é™ºãªæ“ä½œç³»

#### `git clean -fd` (ç¢ºèªãªã—)
```bash
# âŒ å±é™º
git clean -fd  # æœªè¿½è·¡ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¼·åˆ¶å‰Šé™¤

# ç†ç”±:
# - é‡è¦ãªä½œæ¥­ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤±ã‚ã‚Œã‚‹
# - å¾©æ—§ä¸å¯èƒ½
# - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚„ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‰Šé™¤

# âœ… ä»£æ›¿æ¡ˆ
git clean -n   # ã¾ãšç¢ºèª
git clean -i   # ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰
```

## âœ… æ¨å¥¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 1. å®‰å…¨ãªæ©Ÿèƒ½é–‹ç™ºãƒ•ãƒ­ãƒ¼
```bash
# 1. æœ€æ–°ã®çŠ¶æ…‹ã‚’å–å¾—
git checkout main
git pull origin main

# 2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout -b feature/user-authentication-123
git push -u origin feature/user-authentication-123

# 3. å®šæœŸçš„ãªã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "feat: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ©Ÿèƒ½ã®åŸºæœ¬å®Ÿè£…"
git push origin feature/user-authentication-123

# 4. Pull Requestä½œæˆ
gh pr create --title "âœ¨ ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼æ©Ÿèƒ½å®Ÿè£… #123" \
             --body "Fixes #123"

# 5. ãƒãƒ¼ã‚¸å¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
git checkout main
git pull origin main
git branch -d feature/user-authentication-123
```

### 2. å®‰å…¨ãªä¿®æ­£ãƒ•ãƒ­ãƒ¼
```bash
# 1. ãƒ›ãƒƒãƒˆãƒ•ã‚£ãƒƒã‚¯ã‚¹ãƒ–ãƒ©ãƒ³ãƒä½œæˆ
git checkout main
git pull origin main
git checkout -b hotfix/critical-security-fix-456

# 2. ä¿®æ­£å®Ÿè£…
git add .
git commit -m "fix: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®ä¿®æ­£ #456"
git push origin hotfix/critical-security-fix-456

# 3. ç·Šæ€¥PRä½œæˆ
gh pr create --title "ğŸš¨ ç·Šæ€¥ä¿®æ­£: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ #456" \
             --body "Critical security fix" \
             --label "urgent,security"
```

## ğŸ”’ ãƒ–ãƒ©ãƒ³ãƒä¿è­·è¨­å®š

### GitHub Branch Protection Rules
```yaml
# .github/branch-protection.yml
protection_rules:
  main:
    required_status_checks:
      strict: true
      contexts:
        - "ci/tests"
        - "ci/lint"
        - "ci/security-scan"
    enforce_admins: true
    required_pull_request_reviews:
      required_approving_review_count: 2
      dismiss_stale_reviews: true
      require_code_owner_reviews: true
    restrictions:
      users: []
      teams: ["senior-developers"]
    allow_force_pushes: false
    allow_deletions: false
```

### Git Hooksè¨­å®š
```bash
# .git/hooks/pre-push (å®Ÿè¡Œå¯èƒ½ã«ã™ã‚‹)
#!/bin/bash

protected_branch='main'
current_branch=$(git symbolic-ref HEAD | sed -e 's,.*/\(.*\),\1,')

if [ $protected_branch = $current_branch ]; then
    echo "âŒ Direct push to main branch is not allowed!"
    echo "Please create a Pull Request instead."
    exit 1
fi
```

## ğŸ“‹ å¿…é ˆç¢ºèªäº‹é …

### ãƒ—ãƒƒã‚·ãƒ¥å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] **ãƒ–ãƒ©ãƒ³ãƒç¢ºèª**: æ­£ã—ã„ãƒ–ãƒ©ãƒ³ãƒã§ä½œæ¥­ã—ã¦ã„ã‚‹ã‹
- [ ] **å¤‰æ›´å†…å®¹ç¢ºèª**: `git diff --staged` ã§å¤‰æ›´ã‚’ç¢ºèª
- [ ] **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ**: ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã‹
- [ ] **ãƒªãƒ³ã‚¿ãƒ¼å®Ÿè¡Œ**: ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã«æº–æ‹ ã—ã¦ã„ã‚‹ã‹
- [ ] **æ©Ÿå¯†æƒ…å ±ç¢ºèª**: APIã‚­ãƒ¼ã‚„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹

### ãƒãƒ¼ã‚¸å‰ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [ ] **ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰¿èª**: å¿…è¦ãªæ‰¿èªã‚’å¾—ã¦ã„ã‚‹ã‹
- [ ] **CI/CDæˆåŠŸ**: å…¨ã¦ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯ãŒé€šã£ã¦ã„ã‚‹ã‹
- [ ] **ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆè§£æ±º**: ãƒãƒ¼ã‚¸ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆãŒè§£æ±ºã•ã‚Œã¦ã„ã‚‹ã‹
- [ ] **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°**: å¿…è¦ã«å¿œã˜ã¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã—ãŸã‹

## ğŸ›¡ï¸ ç·Šæ€¥æ™‚ã®å¾©æ—§æ‰‹é †

### 1. èª¤ã£ãŸforce pushã®å¾©æ—§
```bash
# 1. reflogã§å±¥æ­´ç¢ºèª
git reflog

# 2. æ­£ã—ã„ã‚³ãƒŸãƒƒãƒˆã«æˆ»ã™
git reset --hard HEAD@{n}  # nã¯æ­£ã—ã„çŠ¶æ…‹ã®ç•ªå·

# 3. å¼·åˆ¶ãƒ—ãƒƒã‚·ãƒ¥ã§å¾©æ—§ï¼ˆç·Šæ€¥æ™‚ã®ã¿ï¼‰
git push --force-with-lease origin main
```

### 2. å‰Šé™¤ã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒã®å¾©æ—§
```bash
# 1. å‰Šé™¤ã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒã®ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã‚’ç¢ºèª
git reflog --all | grep "branch-name"

# 2. ãƒ–ãƒ©ãƒ³ãƒã‚’å¾©æ—§
git checkout -b recovered-branch-name <commit-hash>

# 3. ãƒªãƒ¢ãƒ¼ãƒˆã«ãƒ—ãƒƒã‚·ãƒ¥
git push origin recovered-branch-name
```

### 3. å¤±ã‚ã‚ŒãŸã‚³ãƒŸãƒƒãƒˆã®å¾©æ—§
```bash
# 1. å¤±ã‚ã‚ŒãŸã‚³ãƒŸãƒƒãƒˆã‚’æ¤œç´¢
git fsck --lost-found

# 2. ã‚³ãƒŸãƒƒãƒˆå†…å®¹ã‚’ç¢ºèª
git show <commit-hash>

# 3. æ–°ã—ã„ãƒ–ãƒ©ãƒ³ãƒã§å¾©æ—§
git checkout -b recovery-branch <commit-hash>
```

## ğŸ“Š Gitæ“ä½œç›£è¦–

### å±é™ºãªæ“ä½œã®æ¤œå‡º
```bash
# .gitconfig ã«è¿½åŠ 
[alias]
    # å®‰å…¨ãªã‚¨ã‚¤ãƒªã‚¢ã‚¹ã®ã¿è¨±å¯
    safe-push = push --force-with-lease
    safe-reset = reset --soft
    safe-clean = clean -n
    
    # å±é™ºãªæ“ä½œã®è­¦å‘Š
    force-push = "!echo 'âŒ Use safe-push instead'; false"
    hard-reset = "!echo 'âŒ Use safe-reset instead'; false"
```

### æ“ä½œãƒ­ã‚°ã®è¨˜éŒ²
```bash
# Gitæ“ä½œãƒ­ã‚°ã‚’è¨˜éŒ²ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
#!/bin/bash
# ~/.gitconfig ã® core.hooksPath ã§æŒ‡å®š

echo "$(date): $USER executed: git $*" >> ~/.git-audit.log
```

## ğŸ”„ å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

### é€±æ¬¡ä½œæ¥­
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- [ ] ãƒªãƒ¢ãƒ¼ãƒˆè¿½è·¡ãƒ–ãƒ©ãƒ³ãƒã®æ›´æ–°
- [ ] ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤

### æœˆæ¬¡ä½œæ¥­
- [ ] Gitè¨­å®šã®è¦‹ç›´ã—
- [ ] ãƒ–ãƒ©ãƒ³ãƒä¿è­·ãƒ«ãƒ¼ãƒ«ã®ç¢ºèª
- [ ] ãƒãƒ¼ãƒ å‘ã‘Gitãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
#!/bin/bash
# merged-branches-cleanup.sh

echo "ğŸ§¹ ãƒãƒ¼ã‚¸æ¸ˆã¿ãƒ–ãƒ©ãƒ³ãƒã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"

# ãƒãƒ¼ã‚¸æ¸ˆã¿ãƒ­ãƒ¼ã‚«ãƒ«ãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤
git branch --merged main | grep -v "main\|develop" | xargs -n 1 git branch -d

# ãƒªãƒ¢ãƒ¼ãƒˆè¿½è·¡ãƒ–ãƒ©ãƒ³ãƒã®æ›´æ–°
git remote prune origin

echo "âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†"
```

