---
description: 
globs: 
alwaysApply: false
---
# ãƒ†ã‚¹ãƒˆé§†å‹•é–‹ç™ºï¼ˆTDDï¼‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ«ãƒ¼ãƒ«

## ğŸ”„ TDDã‚µã‚¤ã‚¯ãƒ«ï¼ˆRed-Green-Refactorï¼‰

### 1. ğŸ”´ Red: ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆå¤±æ•—ï¼‰
```python
# ä¾‹: æ–°æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã‚’å…ˆã«ä½œæˆ
def test_user_registration():
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆ"""
    user_service = UserService()
    result = user_service.register_user(
        email="test@example.com",
        password="secure123",
        username="testuser"
    )
    
    assert result.success is True
    assert result.user_id is not None
    assert result.user.email == "test@example.com"
```

### 2. ğŸŸ¢ Green: æœ€å°å®Ÿè£…ï¼ˆæˆåŠŸï¼‰
```python
# ä¾‹: ãƒ†ã‚¹ãƒˆã‚’é€šã™ãŸã‚ã®æœ€å°å®Ÿè£…
class UserService:
    def register_user(self, email: str, password: str, username: str):
        # æœ€å°é™ã®å®Ÿè£…ã§ãƒ†ã‚¹ãƒˆã‚’é€šã™
        user = User(email=email, username=username)
        user.id = generate_id()
        return RegistrationResult(
            success=True,
            user_id=user.id,
            user=user
        )
```

### 3. ğŸ”µ Refactor: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆæ”¹å–„ï¼‰
```python
# ä¾‹: ã‚³ãƒ¼ãƒ‰ã®æ”¹å–„ã¨æœ€é©åŒ–
class UserService:
    def __init__(self, user_repository: UserRepository):
        self.user_repository = user_repository
        self.validator = UserValidator()
    
    def register_user(self, email: str, password: str, username: str):
        # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
        self.validator.validate_email(email)
        self.validator.validate_password(password)
        
        # é‡è¤‡ãƒã‚§ãƒƒã‚¯
        if self.user_repository.exists_by_email(email):
            raise UserAlreadyExistsError(email)
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        user = User.create(email, password, username)
        saved_user = self.user_repository.save(user)
        
        return RegistrationResult.success(saved_user)
```

## ğŸ“‹ ãƒ†ã‚¹ãƒˆä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ãƒ†ã‚¹ãƒˆãƒ¬ãƒ™ãƒ«å®šç¾©
- **å˜ä½“ãƒ†ã‚¹ãƒˆ**: é–¢æ•°ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ¬ãƒ™ãƒ«ï¼ˆ80%ä»¥ä¸Šã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
- **çµåˆãƒ†ã‚¹ãƒˆ**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«é–“é€£æºï¼ˆä¸»è¦ãƒ•ãƒ­ãƒ¼100%ï¼‰
- **ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ**: E2Eã‚·ãƒŠãƒªã‚ªï¼ˆé‡è¦æ©Ÿèƒ½100%ï¼‰
- **å—å…¥ãƒ†ã‚¹ãƒˆ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦ä»¶æ¤œè¨¼ï¼ˆå…¨è¦ä»¶ã‚«ãƒãƒ¼ï¼‰

### ãƒ†ã‚¹ãƒˆå‘½åè¦å‰‡
```python
# ãƒ‘ã‚¿ãƒ¼ãƒ³: test_[æ©Ÿèƒ½]_[æ¡ä»¶]_[æœŸå¾…çµæœ]
def test_user_registration_with_valid_data_should_succeed():
    pass

def test_user_registration_with_duplicate_email_should_fail():
    pass

def test_user_registration_with_invalid_password_should_raise_error():
    pass
```

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†
```python
# Fixtureã‚’ä½¿ç”¨ã—ãŸãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç®¡ç†
@pytest.fixture
def valid_user_data():
    return {
        "email": "test@example.com",
        "password": "SecurePass123!",
        "username": "testuser"
    }

@pytest.fixture
def user_service():
    mock_repository = Mock(spec=UserRepository)
    return UserService(mock_repository)
```

## ğŸ¯ ãƒ†ã‚¹ãƒˆå¯¾è±¡å¢ƒç•Œ

### ãƒ†ã‚¹ãƒˆå¯¾è±¡
- âœ… **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**: å…¨ã¦ã®æ¥­å‹™ãƒ«ãƒ¼ãƒ«
- âœ… **API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: å…¨ã¦ã®HTTPã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- âœ… **ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤**: CRUDæ“ä½œ
- âœ… **ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**: å…¥åŠ›å€¤æ¤œè¨¼ãƒ­ã‚¸ãƒƒã‚¯
- âœ… **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ä¾‹å¤–å‡¦ç†

### ãƒ†ã‚¹ãƒˆå¯¾è±¡å¤–
- âŒ **å¤–éƒ¨API**: ãƒ¢ãƒƒã‚¯ãƒ»ã‚¹ã‚¿ãƒ–ã§ä»£æ›¿
- âŒ **ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: æ—¢ã«ãƒ†ã‚¹ãƒˆæ¸ˆã¿
- âŒ **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: é™çš„ãªè¨­å®šå€¤
- âŒ **ãƒ­ã‚°å‡ºåŠ›**: å‰¯ä½œç”¨ã®ã¿ã®å‡¦ç†

## ğŸ› ï¸ ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

### Python
```bash
# ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
pytest                    # ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
pytest-cov              # ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
pytest-mock             # ãƒ¢ãƒƒã‚¯æ©Ÿèƒ½
pytest-asyncio          # éåŒæœŸãƒ†ã‚¹ãƒˆ

# å“è³ªãƒã‚§ãƒƒã‚¯
flake8                   # é™çš„è§£æ
mypy                     # å‹ãƒã‚§ãƒƒã‚¯
bandit                   # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
```

### JavaScript/TypeScript
```bash
# ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
jest                     # ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
@testing-library/react   # React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
supertest               # API ãƒ†ã‚¹ãƒˆ
playwright              # E2E ãƒ†ã‚¹ãƒˆ

# å“è³ªãƒã‚§ãƒƒã‚¯
eslint                   # é™çš„è§£æ
typescript              # å‹ãƒã‚§ãƒƒã‚¯
```

## ğŸ” ãƒ¢ãƒƒã‚¯/ã‚¹ã‚¿ãƒ–ä½¿ç”¨æ–¹é‡

### ãƒ¢ãƒƒã‚¯å¯¾è±¡
- å¤–éƒ¨APIå‘¼ã³å‡ºã—
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ æ“ä½œ
- æ™‚é–“ä¾å­˜å‡¦ç†
- ãƒ©ãƒ³ãƒ€ãƒ å€¤ç”Ÿæˆ

### ãƒ¢ãƒƒã‚¯å®Ÿè£…ä¾‹
```python
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒƒã‚¯
@pytest.fixture
def mock_user_repository():
    repository = Mock(spec=UserRepository)
    repository.save.return_value = User(id=1, email="test@example.com")
    repository.exists_by_email.return_value = False
    return repository

# å¤–éƒ¨APIãƒ¢ãƒƒã‚¯
@pytest.fixture
def mock_email_service():
    service = Mock(spec=EmailService)
    service.send_welcome_email.return_value = True
    return service
```

## ğŸ“Š ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸åŸºæº–

### ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™
- **å…¨ä½“**: 80%ä»¥ä¸Š
- **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯**: 95%ä»¥ä¸Š
- **APIå±¤**: 90%ä»¥ä¸Š
- **ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤**: 85%ä»¥ä¸Š

### ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
```bash
# Python
pytest --cov=src --cov-report=html --cov-fail-under=80

# JavaScript
npm test -- --coverage --coverageThreshold='{"global":{"branches":80,"functions":80,"lines":80,"statements":80}}'
```

## ğŸš€ CI/CDçµ±åˆ

### GitHub Actionsè¨­å®šä¾‹
```yaml
name: TDD Workflow

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12'
          
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          pip install -r requirements-dev.txt
          
      - name: Run tests with coverage
        run: |
          pytest --cov=src --cov-report=xml --cov-fail-under=80
          
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
```

## ğŸ“ ãƒ†ã‚¹ãƒˆæ–‡æ›¸åŒ–

### ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
```markdown
# ãƒ†ã‚¹ãƒˆä»•æ§˜æ›¸: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ©Ÿèƒ½

## ãƒ†ã‚¹ãƒˆå¯¾è±¡
- æ©Ÿèƒ½: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²
- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«: UserService
- è²¬ä»»è€…: é–‹ç™ºãƒãƒ¼ãƒ 

## ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

### TC001: æ­£å¸¸ç³» - æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã§ã®ç™»éŒ²
- **å‰ææ¡ä»¶**: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿
- **å…¥åŠ›**: email, password, username
- **æœŸå¾…çµæœ**: ç™»éŒ²æˆåŠŸã€ãƒ¦ãƒ¼ã‚¶ãƒ¼IDè¿”å´

### TC002: ç•°å¸¸ç³» - é‡è¤‡ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- **å‰ææ¡ä»¶**: æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨åŒã˜ãƒ¡ãƒ¼ãƒ«
- **å…¥åŠ›**: é‡è¤‡email, password, username  
- **æœŸå¾…çµæœ**: UserAlreadyExistsErrorç™ºç”Ÿ
```

## ğŸ”„ ç¶™ç¶šçš„æ”¹å–„

### ãƒ†ã‚¹ãƒˆå“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“
- ãƒ†ã‚¹ãƒˆæˆåŠŸç‡
- ã‚«ãƒãƒ¬ãƒƒã‚¸æ¨ç§»
- ãƒã‚°æ¤œå‡ºç‡

### å®šæœŸãƒ¬ãƒ“ãƒ¥ãƒ¼é …ç›®
- [ ] ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®å¦¥å½“æ€§
- [ ] ãƒ¢ãƒƒã‚¯ä½¿ç”¨ã®é©åˆ‡æ€§
- [ ] ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œé€Ÿåº¦ã®æœ€é©åŒ–

## âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### è² è·ãƒ†ã‚¹ãƒˆä¾‹
```python
import pytest
import time

def test_user_registration_performance():
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ"""
    user_service = UserService()
    
    start_time = time.time()
    result = user_service.register_user(
        email="perf@test.com",
        password="test123",
        username="perfuser"
    )
    end_time = time.time()
    
    # 1ç§’ä»¥å†…ã«å®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèª
    assert (end_time - start_time) < 1.0
    assert result.success is True
```

